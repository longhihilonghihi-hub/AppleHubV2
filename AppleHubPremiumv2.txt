local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")
local plr = Players.LocalPlayer

local REAL_KEY = "Longdz-1234VietNamese"
local KEY_FILE = "AppleHub_Key.txt"

-- ===== AUTO LOAD (FILE > SESSION) =====
pcall(function()
	if readfile and isfile and isfile(KEY_FILE) then
		if readfile(KEY_FILE) == REAL_KEY then
			loadstring(game:HttpGet("https://raw.githubusercontent.com/longhihilonghihi-hub/AppleHubPremium/main/AppleHub.txt"))()
			return
		end
	end
end)

getgenv().APPLE_KEY_OK = getgenv().APPLE_KEY_OK or false
if getgenv().APPLE_KEY_OK then
	loadstring(game:HttpGet("https://raw.githubusercontent.com/longhihilonghihi-hub/AppleHubPremium/main/AppleHub.txt"))()
	return
end

pcall(function()
	CoreGui:FindFirstChild("AppleHubKeyUI"):Destroy()
end)

local gui = Instance.new("ScreenGui", CoreGui)
gui.Name = "AppleHubKeyUI"
gui.ResetOnSpawn = false

local main = Instance.new("Frame", gui)
main.Size = UDim2.new(0, 380, 0, 300)
main.Position = UDim2.new(0.5, -190, 0.5, -150)
main.BackgroundColor3 = Color3.fromRGB(255,210,220)
Instance.new("UICorner", main).CornerRadius = UDim.new(0,18)

local box = Instance.new("TextBox", main)
box.Size = UDim2.new(1,-40,0,36)
box.Position = UDim2.new(0,20,0,70)
box.PlaceholderText = "Nhập Key..."
box.BackgroundColor3 = Color3.fromRGB(255,255,255)
box.TextColor3 = Color3.fromRGB(40,40,40)
Instance.new("UICorner", box).CornerRadius = UDim.new(0,10)

local save = Instance.new("TextButton", main)
save.Size = UDim2.new(1,-40,0,32)
save.Position = UDim2.new(0,20,0,115)
save.Text = "☐ Save Key"
save.BackgroundColor3 = Color3.fromRGB(255,180,200)
save.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", save).CornerRadius = UDim.new(0,8)

local saveKey = false
save.MouseButton1Click:Connect(function()
	saveKey = not saveKey
	save.Text = saveKey and "☑ Save Key" or "☐ Save Key"
end)

local enter = Instance.new("TextButton", main)
enter.Size = UDim2.new(1,-40,0,36)
enter.Position = UDim2.new(0,20,0,160)
enter.Text = "Enter"
enter.BackgroundColor3 = Color3.fromRGB(120,200,160)
enter.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", enter).CornerRadius = UDim.new(0,10)

enter.MouseButton1Click:Connect(function()
	if box.Text == REAL_KEY then
		if saveKey then
			if writefile then
				pcall(function()
					writefile(KEY_FILE, REAL_KEY) -- FILE SAVE (PC executor)
				end)
			else
				getgenv().APPLE_KEY_OK = true -- SESSION SAVE (Delta)
			end
		end
		gui:Destroy()
		loadstring(game:HttpGet("https://raw.githubusercontent.com/longhihilonghihi-hub/AppleHubPremium/main/AppleHub.txt"))()
	else
		box.Text = ""
		box.PlaceholderText = "Sai key!"
	end
end)
